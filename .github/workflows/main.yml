# On every push this script is executed
on: push
name: Build and deploy GH Pages
jobs:
  build:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: build
        uses: shalzz/zola-deploy-action@v0.14.1
        env:
          # Target branch
          PAGES_BRANCH: gh-pages
          # Provide personal access token
          TOKEN: ${{secrets.TOKEN}}
          # Build only
          BUILD_ONLY: true
      - name: deploy
        run: |-
          cd public
          touch .nojekyll
          git init
          git config user.name "GitHub Actions"
          git config user.email "github-actions-bot@users.noreply.github.com"
          git add .

          git commit -m "Deploy ${GITHUB_REPOSITORY} to ${GITHUB_REPOSITORY}:gh-pages"
          git push --force "https://${GITHUB_ACTOR}:${TOKEN}@github.com/${GITHUB_REPOSITORY}.git" master:gh-pages
        env:
          TOKEN: ${{secrets.TOKEN}}
#       - name: add_nojekyll
#         run: |-
#           git config --global user.email "ssh128@scarletmail.rutgers.edu"
#           git config --global user.name "Sharif Haason"
#           touch .nojekyll
#           git add .
#           git commit -m "auto nojekyll"
#           git push -u origin gh-pages --force
